---
title:  "[Pandas] 판다스"
toc: true
toc_sticky: true
header:
  teaser: /assets/images/deep_learning.jpg

categories:
  - Numpy
tags:
  - AI
last_modified_at: 2021-04-01
---  

## 판다스  

> R에서 데이터 보관, 분석에 용이한 DataFrame을 pandas가 파이썬에 그대로 가져왔다.

> numpy와 달리 다른 자료형의 데이터를 같이 저장할 수 있다.

### 1. 판다스 데이터

#### 1) DataFrame 생성

- List를 통해 만든다

    ```python
    import pandas as pd

    df = pd.DataFrame([['바나나',100, '필리핀'],['사과',300,'대한민국']],columns=['품명','가격','원산지'],index=['no.1','no.2'])

    ```

- Numpy array를 통해 만든다

    ```python
    array1 = np.array([['바나나',100, '필리핀'],['사과',300,'대한민국']])

    df = pd.DataFrame(array1,columns=['품명','가격','원산지'],index=['no.1','no.2'])
    ```

- Series를 통해 만든다

    ```python
    list_of_series = [pd.Series(['바나나',100,'필리핀']),pd.Series(['사과',300,'대한민국'])]

    df = pd.DataFrame(list_of_series)
    ```

- Dictionary를 통해 만든다

    ```python
    list1 = ['바나나', '사과']
    list2 = [100, 300]
    list3 = ['필리핀', '대한민국']

    dict1 = {'품명':list1, '가격':list2, '원산지':list3}

    df = pd.DataFrame(dict1)
    ```  

    ```python
    # 반대 방법 (DataFrame -> ndarray, list, dict)
    
    # DataFrame -> ndarray
    df.values
    --------------------------------------------
    array([[1, 0, 3, 'Braund, Mr. Owen Harris', 'male', 22.0, 1, 0, 'A/5 21171', 7.25, nan, 'S'],
            [2, 1, 1, 'Cumings, Mrs. John Bradley', 'female', 38.0, 1, 0, 'PC 17599', 71.2833, 'C85', 'C']], dtype=object)

    # DataFrame -> (ndarray) -> list: ndarray로 중간 과정 거쳐야 한다
    df.values.tolist()

    # DataFrame -> dict
    df.to_dict()
    ```

- csv파일을 통해 만든다

    ```python
    pd.read.csv('파일경로/파일명', header, index_col)
    ```

#### 2) 데이터의 일반적 특성 파악하기 

```python
# 인덱스 명 출력
df.index  

# 컬럼 명 출력
df.columns

df.shape

# 컬럼명, 데이터 타입, Null건수, 데이터 건수 정보 제공
df.info()
---------------------------------------------------
<class 'pandas.core.frame.DataFrame'>
RangeIndex: 891 entries, 0 to 890
Data columns (total 12 columns):
 #   Column       Non-Null Count  Dtype  
---  ------       --------------  -----  
 0   PassengerId  891 non-null    int64  
 1   Survived     891 non-null    int64  
 2   Pclass       891 non-null    int64  
 3   Name         891 non-null    object 
 4   Sex          891 non-null    object 
 5   Age          714 non-null    float64
 6   SibSp        891 non-null    int64  
 7   Parch        891 non-null    int64  
 8   Ticket       891 non-null    object 
 9   Fare         891 non-null    float64
 10  Cabin        204 non-null    object 
 11  Embarked     889 non-null    object 
dtypes: float64(2), int64(5), object(5)
memory usage: 83.7+ KB

# DataFrame의 통계적 특성 제공
df.describe()
---------------------------------------------------
	PassengerId	Survived	Pclass      	Age	       SibSp	       Parch    	Fare
count	891.000000	891.000000	891.000000	714.000000	891.000000	891.000000	891.000000
mean	446.000000	0.383838	2.308642	29.699118	0.523008	0.381594	32.204208
std	257.353842	0.486592	0.836071	14.526497	1.102743	0.806057	49.693429
min	1.000000	0.000000	1.000000	0.420000	0.000000	0.000000	0.000000
25%	223.500000	0.000000	2.000000	20.125000	0.000000	0.000000	7.910400
50%	446.000000	0.000000	3.000000	28.000000	0.000000	0.000000	14.454200
75%	668.500000	1.000000	3.000000	38.000000	1.000000	0.000000	31.000000
max	891.000000	1.000000	3.000000	80.000000	8.000000	6.000000	512.329200

# Series의 데이터의 value 별 갯수 (.value_counts()는 Series 객체에 있는 메소드이다)
df['Pclass'].value_counts()
-----------------------------------------
3    491
1    216
2    184
Name: Pclass, dtype: int64
```

#### 3) 인덱싱, 슬라이싱을 이용한 추출

- Row명, Column명을 이용

    ```python
    """하나의 Row"""
    df.loc['row']

    """하나의 Column"""
    df.loc[:,'col']
    df['col']

    """여러개의 Row"""
    df.loc[['row1','row2','row4']]

    """여러개의 Column"""
    df.loc[:,['col1','col4']]
    df[['col1','col4']]

    """Row slicing"""
    df.loc['row1':'row4']
    df['row1':'row4'] # 이거는 조금 의외네

    """Column slicing"""
    df.loc[:,'col1':'col3']
    ```

- 위치(번호)를 이용

    ```python
    """하나의 Row"""
    df.iloc[숫자]
    df[숫자]

    """하나의 Column"""
    df.iloc[:,숫자]

    """여러개의 Row"""
    df.iloc[[숫자, 숫자]]
    df[[숫자, 숫자]]

    """여러개의 Column"""
    df.loc[:,[숫자, 숫자]]

    """Row slicing"""
    df.iloc[숫자:숫자]
    df[숫자:숫자] # 이거는 조금 의외네

    """Column slicing"""
    df.iloc[:, 숫자:숫자]
    ```

- Boolean을 이용

    ```python
    """특정 Column조건에 맞는 샘플들"""
    condition = df['col'] > 5
    condition = df['col'] == '대한민국'

    new_df = df[condition]
    ```

#### 4) 인덱스 설정하기

- 인덱스 이름 정하기

    ```python
    df.index.name = '등번호'
    ```

- 특정 Column 인덱스로 가져오기

    ```python
    df.set_index('선수명', inplace=True)
    ```

#### 5) Row명, Column명 바꾸기  

```python
df.rename(index={'old_index': 'new_index'}, inplace=True)

df.rename(columns={'old_col': 'new_col'}, inplace=True)
```

#### 6) Row, Column 삭제하기  

```python
""""샘플 한 개 삭제"""
# axis=0 으로 해도 된다
df.drop('row', axis='index', inplace=True)

"""샘플 몇 개 삭제"""
df.drop(['row1', 'row3'], axis='index', inplace=True)

"""샘플 슬라이싱으로 삭제"""
df.drop(df.index[1:3], axis='index', inplace=True)

"""Column 한 개 삭제"""
del df['col']

# axis=1 로 해도 된다
df.drop('col', axis='columns', inplace=True)

"""Column 몇 개 삭제"""
df.drop(['col1','col3'], axis='columns', inplace=True)

"""Column 슬라이싱으로 삭제"""
df.drop(df.columns[0:3], axis='columns', inplace=True)
```

#### 7) 큰 데이터 셋을 다룰 때  

```python
df.head(5)
df.tail(5)

df.shape

df.columns
df.index

df.info()
df.describe()

df.sort_values(by = 'col', ascending=False, replace=True)

df['col'].unique()
df['col'].describe()
```  

#### 8) 탐색적 데이터 분석(Exploratary Data Analysis)
```python
df['Total'] = df.sum(axis='columns')
```

```python
# 필터링(Filtering)

# 딱 Genre의 값이 Blues인 데이터
df[df['Genre'] == 'Blues']

# Genre의 값 안에 Blues가 포함되어 있는 데이터
df[df['Genre'].str.contains('Blues')]

df[df['Genre'].str.startswith('Blues')]
```  

```python
df['소재지도로명주소'].str.split(n=1, expand=True)
```

```python
# nation 컬럼에 있는 값별로 데이터가 묶인다 (nation이 한국인 데이터 쫙, 미국인 데이터 쫙)
nation_groups = df.groupby('nation')

nation_groups.count()

nation_groups.max()

nation_groups.first()
```

```python
# DataFrame 합치기
pd.merge(price_df, quantity_df, on='Product') # inner join

pd.merge(price_df, quantity_df, on='Product', how='left') # left outer join

pd.merge(price_df, quantity_df, on='Product', how='outer') # full outer join

```
![](/assets/images/pandas_1.png){: width="70%"}  

![](/assets/images/pandas_2.png){: width="70%"}  

![](/assets/images/pandas_3.png){: width="70%"}  

### 3. 판다스 시각화  
데이터는 보통 판다스를 사용해서 다루기 때문에 판다스 데이터를 시각화는 것이 중요합니다. 판다스의 시리즈와 데이터프레임은 기본적으로 plot() 함수를 내장하고 있습니다. 따라서 따로 맷플롯립을 불러오지 않고도 plot()함수를 사용해 데이터를 시각화 할 수 있습니다.  


#### 1) 데이터 준비하기
```python
>>> import pandas as pd  
>>> df = pd.read_csv('broadcast.csv', index_col = 0)
>>> df
```
![](/assets/images/dataframe.png){: width="40%"}  

#### 2) 선 그래프  
```python
>>> df.plot(kind='line') # line이 default값이기 때문에 생략 가능  
>>> df.plot(y='KBS') # df['KBS'].plot()와 같다
>>> df.plot(y=['KBS', 'JTBC']) # df[['KBS', 'JTBC']].plot()와 같다
```  
![](/assets/images/line_plot.png){: width="100%"}  

#### 3) 막대 그래프  
```python
df.plot(kind='bar')
df.plot(kind='barh')
df.plot(kind='bar', stacked=True)
```  
![](/assets/images/bar_plot.png){: width="100%"}  

#### 4) 파이 그래프  
```python
df.loc[2017].plot(kind='pie')  
```

![](/assets/images/pie_plot.png){: width="30%"}  

#### 5) 히스토그램  
```python
df.plot(kind='hist', y='Height')
df.plot(kind='hist', y='Height', bins = 15)
```  
![](/assets/images/hist_plot.png){: width="70%"}  

#### 6) 산점도(Scatter)  
```python
df.plot(kind='scatter', x='reading score', y='writing score')
```
![](/assets/images/scatter_plot.png){: width="30%"}  

#### 7) 박스 그래프  
```python
df['math score'].describe()
df['math score'].plot(kind='box')
df.plot(kind='box', y=['math score', 'reading score', 'writing score'])
```

![](/assets/images/box_plot.png){: width="100%"}  

